<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Star Rating Demo</title>
    <script>
        class StarRating extends HTMLElement {
            #value = 0;

            static get observedAttributes() {
                return ['value', 'readonly'];
            }

            get readonly() {
                return this.hasAttribute('readonly');
            }
            set readonly(val) {
                if (val) {
                    this.setAttribute('readonly', '');
                } else {
                    this.removeAttribute('readonly');
                }
            }

            constructor() {
                super();
            }

            connectedCallback() {
                this.innerHTML = `
                    <div role="radiogroup">
                        <span role="radio" data-star="1" aria-checked="false">☆</span>
                        <span role="radio" data-star="2" aria-checked="false">☆</span>
                        <span role="radio" data-star="3" aria-checked="false">☆</span>
                        <span role="radio" data-star="4" aria-checked="false">☆</span>
                        <span role="radio" data-star="5" aria-checked="false">☆</span>
                    </div>`;
                this.addEventListener('click', this);
                this.#updateDisplay();
            }

            disconnectedCallback() {
                this.removeEventListener('click', this);
            }

            // Note: attributeChangedCallback is called whenever the observed attribute changes,
            // including after the element is inserted into the DOM and when changed via setAttribute.
            // However, it is NOT called for property changes (e.g., el.value = 3) or if the attribute
            // is set after the element is created but before it is defined as a custom element.
            attributeChangedCallback(name, oldValue, newValue) {
                if (name === 'value') {
                    const val = +newValue;
                    if (!isNaN(val) && val !== this.#value) {
                        this.#value = val;
                        this.#updateDisplay();
                    }
                }
            }

            handleEvent(event) {
                if (this.readonly) { return };
                if (event.type === 'click') {
                    const selectedStar = event.target.closest('[data-star]');
                    if (!selectedStar) { return };
                    this.#value = +selectedStar.dataset.star;
                    this.setAttribute('value', this.#value); // reflect change
                    this.#updateDisplay();
                }
            }

            #updateDisplay() {
                this.querySelectorAll('[role="radio"]').forEach((star) => {
                    const starValue = +star.dataset.star;
                    const isSelectedStar = starValue === this.#value;
                    const isFilledStar = starValue <= this.#value;

                    if (isSelectedStar) {
                        star.setAttribute('aria-checked', 'true');
                        star.textContent = '★';
                    } else {
                        star.setAttribute('aria-checked', 'false');
                        star.textContent = isFilledStar ? '★' : '☆';
                    }
                });
            }
        }

        customElements.define('star-rating', StarRating);
    </script>
</head>

<body>
    <star-rating></star-rating>
</body>

</html>